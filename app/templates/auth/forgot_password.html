{% extends "base.html" %}

{% block title %}Forgot Password{% endblock %}

{% block main_class %}main-content--full{% endblock %}

{% block extra_css %}
<style>
.steps-container {
    max-width: 600px;
    margin: 32px auto 0;
}

.step-card {
    background: var(--bg-surface);
    border: 1px solid var(--border-default);
    border-radius: var(--radius-lg);
    padding: 24px;
    margin-bottom: 16px;
    display: flex;
    gap: 20px;
    transition: all var(--transition-normal);
}

.step-card:hover {
    box-shadow: var(--shadow-md);
    border-color: var(--accent);
}

.step-number {
    width: 48px;
    height: 48px;
    border-radius: 50%;
    background: var(--accent);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
    font-weight: 700;
    flex-shrink: 0;
}

.step-content h3 {
    font-size: 16px;
    font-weight: 600;
    margin-bottom: 8px;
    color: var(--text-primary);
}

.step-content p {
    color: var(--text-muted);
    font-size: 14px;
    line-height: 1.6;
}

.success-message {
    display: none;
    text-align: center;
    padding: 32px;
    background: var(--success-light);
    border: 1px solid var(--success);
    border-radius: var(--radius-lg);
    margin-top: 24px;
}

.success-message.show {
    display: block;
}
</style>
{% endblock %}

{% block content %}
<div style="min-height: calc(100vh - var(--navbar-height) - 200px); display: flex; align-items: center; justify-content: center; padding: 32px 16px;">
    <div style="max-width: 540px; width: 100%;">
        
        <div class="card" style="padding: 40px; text-align: center; margin-bottom: 24px;">
            <div style="width: 64px; height: 64px; background: var(--info-light); border-radius: 50%;
                        display: flex; align-items: center; justify-content: center; margin: 0 auto 20px;
                        font-size: 32px;">
                üîë
            </div>
            <h1 style="font-size: 28px; font-weight: 700; margin-bottom: 12px;">Forgot your password?</h1>
            <p style="color: var(--text-muted); font-size: 15px; line-height: 1.6;">
                No worries! Enter your email address and we'll send you instructions to reset your password.
            </p>
        </div>

        <div class="card" style="padding: 32px;">
            <form id="forgotPasswordForm" onsubmit="handleForgotPassword(event)">
                <div style="margin-bottom: 24px;">
                    <label class="input-label" for="email">Email Address</label>
                    <input type="email" id="email" class="input" placeholder="your@email.com" required>
                </div>

                <button type="submit" class="btn btn--primary" style="width: 100%; padding: 14px;" id="submitBtn">
                    <span id="btnText">Send Reset Instructions</span>
                    <span id="btnSpinner" style="display: none;">‚è≥</span>
                </button>
            </form>

            <div class="success-message" id="successMessage">
                <div style="font-size: 48px; margin-bottom: 16px;">‚úÖ</div>
                <h3 style="font-size: 20px; font-weight: 700; margin-bottom: 8px; color: var(--success);">
                    Check your email!
                </h3>
                <p style="color: var(--text-muted); font-size: 14px;">
                    We've sent password reset instructions to <strong id="sentEmail"></strong>
                </p>
            </div>

            <div style="text-align: center; margin-top: 24px; padding-top: 24px; border-top: 1px solid var(--border-default);">
                <a href="/login" style="font-size: 14px; color: var(--accent); font-weight: 600;">
                    ‚Üê Back to login
                </a>
            </div>
        </div>

        <!-- Instructions -->
        <div class="steps-container">
            <h2 style="font-size: 20px; font-weight: 700; margin-bottom: 20px; text-align: center;">
                How password reset works
            </h2>

            <div class="step-card">
                <div class="step-number">1</div>
                <div class="step-content">
                    <h3>Enter your email</h3>
                    <p>Provide the email address associated with your Gosha account.</p>
                </div>
            </div>

            <div class="step-card">
                <div class="step-number">2</div>
                <div class="step-content">
                    <h3>Check your inbox</h3>
                    <p>We'll send you an email with a secure link to reset your password. The link expires in 1 hour.</p>
                </div>
            </div>

            <div class="step-card">
                <div class="step-number">3</div>
                <div class="step-content">
                    <h3>Create new password</h3>
                    <p>Click the link in the email and create a new strong password for your account.</p>
                </div>
            </div>

            <div class="step-card">
                <div class="step-number">4</div>
                <div class="step-content">
                    <h3>Log in with new password</h3>
                    <p>Use your new password to access your account and continue managing your links.</p>
                </div>
            </div>
        </div>

        <!-- Help Section -->
        <div class="card" style="margin-top: 32px; padding: 24px; background: var(--bg-secondary);">
            <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 12px;">Need help?</h3>
            <p style="color: var(--text-muted); font-size: 14px; line-height: 1.6; margin-bottom: 16px;">
                If you don't receive the email within a few minutes, check your spam folder or contact our support team.
            </p>
            <div style="display: flex; gap: 12px; flex-wrap: wrap;">
                <a href="mailto:support@gosha.link" class="btn btn--secondary" style="padding: 10px 20px;">
                    üìß Contact Support
                </a>
                <a href="/login" class="btn btn--ghost" style="padding: 10px 20px;">
                    Try logging in again
                </a>
            </div>
        </div>

    </div>
</div>

<script>
async function handleForgotPassword(e) {
    e.preventDefault();
    
    const submitBtn = document.getElementById('submitBtn');
    const btnText = document.getElementById('btnText');
    const btnSpinner = document.getElementById('btnSpinner');
    const successMessage = document.getElementById('successMessage');
    const form = document.getElementById('forgotPasswordForm');
    
    submitBtn.disabled = true;
    btnText.style.display = 'none';
    btnSpinner.style.display = 'inline';
    
    const email = document.getElementById('email').value;
    
    // Simulate API call (in production, this would send actual email)
    setTimeout(() => {
        // Show success message
        form.style.display = 'none';
        successMessage.classList.add('show');
        document.getElementById('sentEmail').textContent = email;
        
        Toast.show('Password reset instructions sent!', 'success');
        
        submitBtn.disabled = false;
        btnText.style.display = 'inline';
        btnSpinner.style.display = 'none';
    }, 1500);
    
    /* In production, uncomment this:
    try {
        const response = await fetch('/api/v1/auth/forgot-password', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email }),
        });
        
        if (response.ok) {
            form.style.display = 'none';
            successMessage.classList.add('show');
            document.getElementById('sentEmail').textContent = email;
            Toast.show('Password reset instructions sent!', 'success');
        } else {
            const error = await response.json();
            Toast.show(error.detail || 'Failed to send reset email', 'error');
        }
    } catch (error) {
        Toast.show('Network error', 'error');
    } finally {
        submitBtn.disabled = false;
        btnText.style.display = 'inline';
        btnSpinner.style.display = 'none';
    }
    */
}
</script>
{% endblock %}
